<!DOCTYPE html>
<html lang="en">

  <head>
    <!-- ## for client-side less
      <link rel="stylesheet/less" type="text/css" href="https://www.sglavoie.com/theme/css/style.less">
      <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
      -->
      <link rel="stylesheet" type="text/css" href="https://www.sglavoie.com/theme/css/style.css">
      <link rel="stylesheet" type="text/css" href="https://www.sglavoie.com/theme/css/pygments.css">
      <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="author" content="Sébastien Lavoie">
      <meta name="description" content="Posts and writings by Sébastien Lavoie">

      <link href="https://www.sglavoie.com/feeds/sglavoie.rss.xml" type="application/rss+xml" rel="alternate" title="sglavoie.com RSS" />

      <!-- Favicon -->
      <link rel="apple-touch-icon" sizes="180x180" href="/theme/favicon/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/theme/favicon/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/theme/favicon/favicon-16x16.png">
      <link rel="manifest" href="/theme/favicon/site.webmanifest">
      <link rel="mask-icon" href="/theme/favicon/safari-pinned-tab.svg" color="#5bbad5">
      <link rel="shortcut icon" href="/theme/favicon/favicon.ico">
      <meta name="msapplication-TileColor" content="#2d89ef">
      <meta name="msapplication-TileImage" content="/theme/favicon/mstile-144x144.png">
      <meta name="msapplication-config" content="/theme/favicon/browserconfig.xml">
      <meta name="theme-color" content="#000000">
      <meta name="msapplication-config" content="/theme/favicon/browserconfig.xml">
      <meta name="theme-color" content="#000000">

<meta name="keywords" content="api, click, python, script">

      <title>
        sglavoie.com
&ndash; Have You Been&nbsp;Pwned?      </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-150998392-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
  </head>

  <body>
    <aside>
      <div id="user_meta">
        <a href="https://www.sglavoie.com">
          <img src="https://www.sglavoie.com/theme/images/logo.png" alt="logo">
        </a>
        <h2><a href="https://www.sglavoie.com">sglavoie.com</a></h2>
        <p></p>
        <ul>
          <li><a href="https://www.sglavoie.com/category/automation.html">automation</a></li>
          <li><a href="https://www.sglavoie.com/category/tips-and-tricks.html">tips-and-tricks</a></li>
          <li><a href="https://www.sglavoie.com/category/tools.html">tools</a></li>
          <li><a href="https://www.sglavoie.com/category/workflow.html">workflow</a></li>
        </ul>
      </div>
    </aside>

    <main>
      <header>
        <p>
        <a href="https://www.sglavoie.com">Index</a> &brvbar; <a href="https://www.sglavoie.com/archives.html">Archives</a>
        &brvbar; <a href="https://www.sglavoie.com/tags.html">Tags</a>
        &brvbar; <a href="https://www.sglavoie.com/learning-progress-2019.html">Learning Progress</a>
        &brvbar; <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml">RSS</a>
        </p>
      </header>

<article>
  <div class="article_title">
    <h1><a href="https://www.sglavoie.com/posts/2019/03/21/have-you-been-pwned/">Have You Been&nbsp;Pwned?</a></h1>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 4 minutes</p>
  </div>
  <div class="article_text">
    <p><a href="https://haveibeenpwned.com/">Have I Been Pwned?</a> has a very simple and
accessible <span class="caps">API</span> that&#8217;s perfect to work with as a beginner. There are
different ways to retrieve information and the script below is only
one glimpse into the numerous possibilities available. It is built in
a way that makes it easy to add features and functionality thanks to
<a href="https://github.com/pallets/click">Click</a>, a wonderful <em>&#8220;command line
interface toolkit&#8221;</em>.</p>
<h3>Python to the&nbsp;rescue</h3>
<p>The following script uses <a href="https://github.com/pallets/click">Click</a>
to build a tiny command-line interface instead of more
traditional tools like <code>argparse</code>. You will also need
<a href="https://github.com/kennethreitz/requests">requests</a> to peek inside the
<span class="caps">API</span>. Both can be obtained as follow in a&nbsp;terminal:</p>
<div class="highlight"><pre><span></span>$ pip install click requests
</pre></div>


<p>And now, the <em>pièce de résistance</em> <i class="fas fa-smile-wink"></i>.</p>
<div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Simple script that will take advantage of haveibeenpwned.com&#39;s API to</span>
<span class="sd">find out if your password has been breached.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="c1"># Standard library imports</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="c1"># Third party library imports</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">requests</span>


<span class="c1"># Needed to access API</span>
<span class="n">PASS_URL</span> <span class="o">=</span> <span class="s1">&#39;https://api.pwnedpasswords.com/range/&#39;</span>

<span class="c1"># Script information</span>
<span class="n">VERSION</span> <span class="o">=</span> <span class="s1">&#39;0.1.1&#39;</span>
<span class="n">LOGO</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1"> __                        __   __</span>
<span class="s1">|  |--.---.-.--.--.-----. |__| |  |--.-----.-----.-----.</span>
<span class="s1">|     |  _  |  |  |  -__| |  | |  _  |  -__|  -__|     |</span>
<span class="s1">|__|__|___._|\___/|_____| |__| |_____|_____|_____|__|__|</span>

<span class="s1">                               __  _____</span>
<span class="s1">.-----.--.--.--.-----.-----.--|  ||__   |</span>
<span class="s1">|  _  |  |  |  |     |  -__|  _  |&#39;,  ,-&#39;</span>
<span class="s1">|   __|________|__|__|_____|_____| |--|</span>
<span class="s1">|__|                               &#39;--&#39;  &#39;&#39;&#39;</span>


<span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="c1"># `param` required by `click`</span>
    <span class="sd">&quot;&quot;&quot;Print information about the program and exit.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="ow">or</span> <span class="n">context</span><span class="o">.</span><span class="n">resilient_parsing</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;{LOGO}</span><span class="se">\n</span><span class="s1">{&quot;Python 3.6+ Checker&quot;.rjust(60)}</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">f</span><span class="s1">&#39;{(&quot;v&quot; + VERSION).rjust(60)}&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">context</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">pass_to_sha1</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Will convert `password` with SHA-1 algorithm and return the short</span>
<span class="sd">    version with the first five characters and the long version with</span>
<span class="sd">    everything but the first five characters as a tuple.&quot;&quot;&quot;</span>

    <span class="n">my_password</span> <span class="o">=</span> <span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c1"># converts to byte string</span>

    <span class="n">complete_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">my_password</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">long_hash</span> <span class="o">=</span> <span class="n">complete_hash</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span>
    <span class="n">short_hash</span> <span class="o">=</span> <span class="n">complete_hash</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span>


<span class="k">def</span> <span class="nf">check_password</span><span class="p">(</span><span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Consult haveibeenpwned.com to see how many times the password has</span>
<span class="sd">    been breached.&quot;&quot;&quot;</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Please note that only the 5 first characters from your &#39;</span>
                <span class="s1">&#39;SHA-1 ENCRYPTED password are sent to haveibeenpwned.com.&#39;</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">PASS_URL</span> <span class="o">+</span> <span class="n">short_hash</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">long_hash</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">num_times</span> <span class="o">=</span> <span class="s1">&#39;occurrences&#39;</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">36</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;occurence&#39;</span>
            <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Your password was found!&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">bold</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;→ {line[36:]} {num_times}&#39;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Your password was NOT found!&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>


<span class="nd">@click.group</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span>
    <span class="s1">&#39;--info&#39;</span><span class="p">,</span>
    <span class="n">is_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">print_info</span><span class="p">,</span>
    <span class="n">expose_value</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">is_eager</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Print some information about the program and exit.&quot;</span><span class="p">)</span>
<span class="nd">@click.version_option</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">VERSION</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(version)s</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">hibp</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;A simple command-line interface to make use of</span>
<span class="sd">    haveibeenpwned.com&#39;s data.</span>

<span class="sd">    Type `python3 pwned.py usage` for more info (or whatever way you</span>
<span class="sd">    call Python 3).&quot;&quot;&quot;</span>


<span class="nd">@hibp.command</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">usage</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Give examples on how to use this script.&quot;&quot;&quot;</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Examples:&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;python3 pwned.py check --help for more info.&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;python3 pwned.py check -p MyPasswordHere&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;python3 pwned.py check --password MyPasswordHere&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

    <span class="n">click</span><span class="o">.</span><span class="n">echo</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;For more complicated passwords, you have to use quotes and &#39;</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;escape symbols with </span><span class="se">\\</span><span class="s1"> where appropriate:&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;python3 pwned.py check -p &quot;as0d9</span><span class="se">\\</span><span class="s1">&quot;asg0</span><span class="se">\&#39;\&#39;</span><span class="s1">A=)SYD&quot;&#39;</span><span class="p">,</span>
                <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>


<span class="nd">@hibp.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span>
    <span class="s1">&#39;-p&#39;</span><span class="p">,</span>
    <span class="s1">&#39;--password&#39;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Reveal if match exists with `password`.&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Tell if your password has been breached.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">password</span><span class="p">:</span>
        <span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span> <span class="o">=</span> <span class="n">pass_to_sha1</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
        <span class="n">check_password</span><span class="p">(</span><span class="n">short_hash</span><span class="p">,</span> <span class="n">long_hash</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">password</span><span class="p">:</span>
        <span class="n">click</span><span class="o">.</span><span class="n">secho</span><span class="p">(</span><span class="s1">&#39;Run `pwned.py check --help` for more info.&#39;</span><span class="p">,</span> <span class="n">fg</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">hibp</span><span class="p">()</span>
</pre></div>


<h4>Example&nbsp;usage</h4>
<p><a href="https://www.sglavoie.com/images/posts/0011_have-i-been-pwned/have_i_been_pwned_script.png"><img src="https://www.sglavoie.com/images/posts/0011_have-i-been-pwned/have_i_been_pwned_script.png" alt="have_i_been_pwned_script" class="max-size-img-post"></a></p>
<h2>Conclusion</h2>
<p>If you are familiar with Python <i class="fab fa-python"></i>,
you can easily make sense of how this little tool works by
reading its code. You can also have a look at this <a href="https://github.com/sglavoie/python-utilities/tree/master/haveibe
enpwnwed_password_checker">repository on
GitHub</a> <i class="fab fa-github-alt"></i> if you want
to fork it or reuse it any other way you wish. I have personally found
it much easier to work with <a href="https://github.com/pallets/click">Click</a>
instead of <code>argparse</code> and <code>optparse</code>. I haven&#8217;t got to try
<a href="https://github.com/docopt/docopt">docopt</a> yet, but it is almost equally
as popular as Click on GitHub at the time of this writing and its
Pythonic way makes it another great option to&nbsp;consider.</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Thu 21 March 2019</p>
    <p>Category: <a href="https://www.sglavoie.com/category/automation.html">automation</a>
 &ndash; Tags:
      <a href="https://www.sglavoie.com/tag/api.html">api</a>,      <a href="https://www.sglavoie.com/tag/click.html">click</a>,      <a href="https://www.sglavoie.com/tag/python.html">python</a>,      <a href="https://www.sglavoie.com/tag/script.html">script</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "posts/2019/03/21/have-you-been-pwned/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//sglavoie.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


      <div id="ending_message">
        <h3>Subscribe to the Newsletter</h3>
        <form style="border:1px solid #ccc;padding:3px;text-align:center;" action="https://tinyletter.com/sglavoie" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/sglavoie', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><p><label for="tlemail">Enter your email address</label></p><p><input type="text" style="width:140px" name="email" id="tlemail" /></p><input type="hidden" value="1" name="embed"/><input type="submit" value="Subscribe" /><p><a href="https://tinyletter.com" target="_blank">powered by TinyLetter</a></p></form>
        <p>&copy; Sébastien Lavoie. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>.</p>
      </div>
    </main>
  </body>
</html>