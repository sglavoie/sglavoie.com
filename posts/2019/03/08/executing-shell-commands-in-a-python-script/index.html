<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="https://www.sglavoie.com/theme/css/style.less">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="stylesheet" type="text/css" href="https://www.sglavoie.com/theme/css/style.css">
  <link rel="stylesheet" type="text/css" href="https://www.sglavoie.com/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Sébastien Lavoie">
  <meta name="description" content="Posts and writings by Sébastien Lavoie">

  <link href="https://www.sglavoie.com/feeds/sglavoie.rss.xml" type="application/rss+xml" rel="alternate" title="sglavoie.com RSS" />

<meta name="keywords" content="python, script">

  <title>
    sglavoie.com
&ndash; Executing Shell Commands in a Python&nbsp;Script  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-150998392-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="https://www.sglavoie.com">
        <img src="https://www.sglavoie.com/theme/images/logo.png" alt="logo">
      </a>
      <h2><a href="https://www.sglavoie.com">sglavoie.com</a></h2>
      <p></p>
      <ul>
        <li><a href="https://www.sglavoie.com/category/automation.html">automation</a></li>
        <li><a href="https://www.sglavoie.com/category/tips-and-tricks.html">tips-and-tricks</a></li>
        <li><a href="https://www.sglavoie.com/category/tools.html">tools</a></li>
        <li><a href="https://www.sglavoie.com/category/workflow.html">workflow</a></li>
      </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>
      <a href="https://www.sglavoie.com">Index</a> &brvbar; <a href="https://www.sglavoie.com/archives.html">Archives</a>
&brvbar; <a href="https://www.sglavoie.com/tags.html">Tags</a>
&brvbar; <a href="https://www.sglavoie.com/learning-progress-2019.html">Learning Progress</a>
      &brvbar; <a href="https://www.sglavoie.com/feeds/sglavoie.rss.xml">RSS</a>
      </p>
    </header>

<article>
  <div class="article_title">
    <h1><a href="https://www.sglavoie.com/posts/2019/03/08/executing-shell-commands-in-a-python-script/">Executing Shell Commands in a Python&nbsp;Script</a></h1>
  </div>
  <div class="article_readtime">
    <p>Estimated read time: 2 minutes</p>
  </div>
  <div class="article_text">
    <p>Python is awesome for producing high-quality code quickly
and efficiently, but it is not necessary to reinvent the
wheel in each project: this is why the third-party library on
<a href="https://pypi.org/">PyPI</a> is so extensive. There are also occasions when
it is convenient to execute shell commands available in the terminal,
either to retrieve its output or to perform some work in the background.
I have wanted to do both when building this website, so here is one way
to accomplish&nbsp;this!</p>
<h3>Retrieve the&nbsp;output</h3>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_tree</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Execute `tree` command and store the output in</span>
<span class="sd">    `tree.txt`.&#39;&#39;&#39;</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">getoutput</span><span class="p">(</span><span class="n">f</span><span class="s1">&#39;tree .&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;./tree.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>


<span class="n">read_tree</span><span class="p">()</span>
</pre></div>


<p>In this example, the structure from the current directory is printed
when executing the code and it is later stored in a file. The output
could look something like the&nbsp;following:</p>
<div class="highlight"><pre><span></span><span class="p">.</span>
<span class="err">├──</span> <span class="n">database_example</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">example</span><span class="p">.</span><span class="n">sqlite</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">db_manager</span><span class="p">.</span><span class="n">py</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">review</span>
<span class="err">│</span>   <span class="err">│</span>   <span class="err">└──</span> <span class="n">sql_queries</span><span class="p">.</span><span class="n">txt</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">settings</span><span class="p">.</span><span class="n">py</span>
<span class="err">├──</span> <span class="n">database_sql</span><span class="p">.</span><span class="n">py</span>
<span class="err">├──</span> <span class="n">dump</span><span class="p">.</span><span class="k">sql</span>
<span class="err">├──</span> <span class="n">example</span><span class="p">.</span><span class="n">db</span>
<span class="err">├──</span> <span class="n">example</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="k">sql</span>
<span class="err">├──</span> <span class="n">example_info</span><span class="p">.</span><span class="n">txt</span>
<span class="err">├──</span> <span class="n">example_old</span><span class="p">.</span><span class="n">db</span>
<span class="err">├──</span> <span class="n">example_old</span><span class="p">.</span><span class="n">db</span><span class="p">.</span><span class="k">sql</span>
<span class="err">├──</span> <span class="n">sample</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="n">chinook</span><span class="p">.</span><span class="n">db</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="n">sqlite</span><span class="o">-</span><span class="n">sample</span><span class="o">-</span><span class="k">database</span><span class="o">-</span><span class="n">diagram</span><span class="o">-</span><span class="n">color</span><span class="p">.</span><span class="n">pdf</span>
<span class="err">├──</span> <span class="n">test</span><span class="p">.</span><span class="n">db</span>
<span class="err">└──</span> <span class="n">test</span><span class="p">.</span><span class="k">sql</span>

<span class="mi">3</span> <span class="n">directories</span><span class="p">,</span> <span class="mi">15</span> <span class="n">files</span>
</pre></div>


<h3>Execute a command in the&nbsp;background</h3>
<p>There are also instances in which is it useful to execute a program
from the terminal inside a Python script. This website, for example,
currently exports daily Git statistics in the <code>output/</code> folder. This
looks like&nbsp;this:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">daily_stats</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Execute `Gitstats` once a day based on the date found in</span>
<span class="sd">    `stats_counter.txt`. Very simple with a caveat: it won&#39;t check if</span>
<span class="sd">    there are new commits on the same day if stats have already been</span>
<span class="sd">    generated on that day.&#39;&#39;&#39;</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stats_counter.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">content</span> <span class="o">!=</span> <span class="n">today</span><span class="p">:</span>
        <span class="n">current_loc</span> <span class="o">=</span> <span class="n">current_path</span><span class="p">()</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;gitstats&quot;</span><span class="p">,</span> <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;project_name=&#39;sglavoie.com&#39;&quot;</span><span class="p">,</span>
               <span class="n">f</span><span class="s2">&quot;{current_loc}&quot;</span><span class="p">,</span> <span class="n">f</span><span class="s2">&quot;{current_loc}/output/stats/&quot;</span><span class="p">]</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;stats_counter.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
</pre></div>


<p>This is an automated process, which is something Python is easy to use
for. However, it won&#8217;t be necessary to program everything: it all gets
generated on&nbsp;demand!</p>
<h2>Conclusion</h2>
<p>I am always amazed at how easy it can be to automate simple tasks like
those mentioned above. Programming can be very rewarding regardless of
initial abilities. Just beyond the most basic stuff, suddenly there is a
world that opens up to those that stay curious long enough <i class="fas
fa-smile"></i>.</p>
  </div>
  <div class="article_meta">
    <p>Posted on: Fri 08 March 2019</p>
    <p>Category: <a href="https://www.sglavoie.com/category/tips-and-tricks.html">tips-and-tricks</a>
 &ndash; Tags:
      <a href="https://www.sglavoie.com/tag/python.html">python</a>,      <a href="https://www.sglavoie.com/tag/script.html">script</a>    </p>
  </div>

  <div id="article_comments">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_identifier = "posts/2019/03/08/executing-shell-commands-in-a-python-script/";
        (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = '//sglavoie.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
         })();
    </script>
  </div>

</article>


    <div id="ending_message">
       <h3>Subscribe to the Newsletter</h3>
       <form style="border:1px solid #ccc;padding:3px;text-align:center;" action="https://tinyletter.com/sglavoie" method="post" target="popupwindow" onsubmit="window.open('https://tinyletter.com/sglavoie', 'popupwindow', 'scrollbars=yes,width=800,height=600');return true"><p><label for="tlemail">Enter your email address</label></p><p><input type="text" style="width:140px" name="email" id="tlemail" /></p><input type="hidden" value="1" name="embed"/><input type="submit" value="Subscribe" /><p><a href="https://tinyletter.com" target="_blank">powered by TinyLetter</a></p></form>
      <p>&copy; Sébastien Lavoie. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. Theme by Giulio Fidente on <a href="https://github.com/gfidente/pelican-svbhack" target="_blank">github</a>.</p>
    </div>
  </main>
</body>
</html>